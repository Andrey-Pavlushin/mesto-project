(()=>{"use strict";function e(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var t="a49b225c9ff9fb5cb60da697",r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-28",headers:{authorization:"da67faeb-c3b2-41d3-a184-b77566b0c3bf","Content-Type":"application/json"}};function n(t,r){return fetch(t,r).then(e)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",a)}function a(e){"Escape"==e.key&&o(document.querySelector(".popup_opened"))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",a)}function u(e,o,a,u,i){var l=o.content.cloneNode(!0),s=l.querySelector(".photo-card__image"),d=l.querySelector(".photo-card__header"),f=l.querySelector(".photo-card__trash"),m=l.querySelector(".photo-card__heart-button"),p=l.querySelector(".photo-card__heart-number");return s.src=e.link,s.alt=e.name,d.textContent=e.name,p.textContent=e.likes.length,e.owner._id===t?f.addEventListener("click",(function(t){var o;(o=e._id,n("".concat(r.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:r.headers})).then((function(){t.target.closest(".photo-card").remove()})).catch((function(e){return console.log(e)}))})):f.style.display="none",s.addEventListener("click",(function(e){return function(e,t,r,n){c(t),r.src=e.target.src,r.alt=e.target.alt,n.textContent=e.target.alt}(e,a,u,i)})),function(e){return e.likes.some((function(e){return e._id===t}))}(e)&&m.classList.add("photo-card__heart-button_active"),m.addEventListener("click",(function(t){return function(e,t,o){e.classList.contains("photo-card__heart-button_active")?function(e){return n("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers})}(t).then((function(t){!function(e){e.classList.remove("photo-card__heart-button_active")}(e),o.textContent=t.likes.length})).catch((function(e){return console.log(e)})):function(e){return n("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers})}(t).then((function(t){!function(e){e.classList.add("photo-card__heart-button_active")}(e),o.textContent=t.likes.length})).catch((function(e){return console.log(e)}))}(t.target,e._id,p)})),l}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelector(".popup-image"),t=document.querySelector(".popup-image__url"),a=document.querySelector(".popup-image__text"),l=document.querySelector(".popup-image__close-button"),s=document.querySelector(".popup-profile"),d=document.querySelector(".popup-profile__close-button"),f=document.querySelector(".popup-card"),m=document.querySelector(".popup-card__close-button"),p=document.querySelector(".form-card__save-button"),_=document.querySelector(".profile__avatar"),v=document.querySelector(".popup-avatar"),y=document.querySelector(".popup-avatar__close-button"),h=document.querySelector(".form-avatar__save-button"),b=document.querySelector(".profile__name"),S=document.querySelector(".profile__caption"),q=document.querySelector(".profile__avatar-image"),g=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),C=document.querySelector(".form-profile"),E=document.querySelector(".form-profile__input_info_name"),k=document.querySelector(".form-profile__input_info_caption"),x=document.querySelector(".form-profile__save-button"),A=document.querySelector(".form-avatar"),U=document.querySelector(".form-avatar__input"),O=document.querySelector(".form-avatar__save-button"),T=document.querySelector(".form-card"),j=document.querySelector(".form-card__save-button"),w=document.querySelector(".form-card__input_info_name"),D=document.querySelector(".form-card__input_info_image"),P=document.querySelector(".photo-grid__list"),B=document.querySelector("#card");function M(e,t){b.textContent=e,S.textContent=t}Promise.all([n("".concat(r.baseUrl,"/users/me"),{headers:r.headers}),n("".concat(r.baseUrl,"/cards"),{headers:r.headers})]).then((function(r){var n,o,c=(o=2,function(e){if(Array.isArray(e))return e}(n=r)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,c,u=[],i=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=a.call(r)).done)&&(u.push(n.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(l)throw o}}return u}}(n,o)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=c[0];c[1].forEach((function(r){return P.appendChild(u(r,B,e,t,a))})),M(l.name,l.about),q.src=l.avatar})).catch((function(e){return console.log(e)})),d.addEventListener("click",(function(){return o(s)})),l.addEventListener("click",(function(){return o(e)})),m.addEventListener("click",(function(){return o(f)})),y.addEventListener("click",(function(){return o(v)})),g.addEventListener("click",(function(){c(s),E.value=b.textContent,k.value=S.textContent})),L.addEventListener("click",(function(){return c(f)})),_.addEventListener("click",(function(){return c(v)})),C.addEventListener("submit",(function(e){e.preventDefault(),x.textContent="Сохранение...",function(e,t){return n("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})})}(E.value,k.value).then((function(t){M(t.name,t.about),o(s),e.target.reset()})).catch((function(e){return console.log(e)})).finally((function(){return x.textContent="Сохранить"}))})),T.addEventListener("submit",(function(c){var i,l;c.preventDefault(),p.textContent="Сохранение...",(i=w.value,l=D.value,n("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:i,link:l})})).then((function(r){P.insertBefore(u(r,B,e,t,a),P.firstChild),o(f),c.target.reset()})).catch((function(e){return console.log(e)})).finally((function(){return p.textContent="Сохранить"})),j.disabled=!0,j.classList.add("form__save-button_disabled")})),A.addEventListener("submit",(function(e){var t;e.preventDefault(),h.textContent="Сохранение...",(t=U.value,n("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})})).then((function(t){q.src=t.avatar,h.textContent="Сохранить",o(v),e.target.reset()})).catch((function(e){return console.log(e)})).finally((function(){return h.textContent="Сохранить"})),O.disabled=!0,O.classList.add("form__save-button_disabled")})),function(e){var t=document.querySelectorAll(e.formSelector);Array.from(t).forEach((function(t){var n=t.querySelectorAll(e.inputSelector),c=t.querySelector(e.submitButtonSelector);t.addEventListener("input",(function(u){!function(e,t,r,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?(t.classList.remove(r),a(e,t,n)):(t.classList.add(r),o(e,t,n,t.validationMessage))}(t,u.target,e.inputErrorClass),r(n,c,e.inactiveButtonClass)}))}));var r=function(e,t,r){n(e)?(t.disabled=!0,t.classList.add(r)):(t.disabled=!1,t.classList.remove(r))},n=function(e){return Array.from(e).some((function(e){return!e.validity.valid}))},o=function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent=n,o.classList.add(r)},a=function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));n.classList.remove(r),n.textContent=""}}({formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"}),[f,e,s,v].forEach((function(e){return e.addEventListener("click",(function(e){e.target===e.currentTarget&&o(e.target)}))}))}))})();